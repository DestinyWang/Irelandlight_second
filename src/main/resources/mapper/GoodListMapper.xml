<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.irelandlight.mapper.GoodsListMapper">
    <!--
       List<GoodsVO> queryAllGoods();
       List<GoodsVO> queryBySearchGoods(String searchBox);
       List<GoodsVO> queryFilterGoods(FilterGoodsVO filter);
    -->
    <!--查找所有商品列表的结果-->
    <resultMap id="GoodsResult" type="com.irelandlight.vo.GoodsVO">
        <id column="id" property="goodsId"/>
        <result column="url" property="goodsImageUrl"/>
        <result column="name" property="goodsName"/>
        <result column="min_price" property="goodsPrice"/>
    </resultMap>
    <sql id="goodsSelect">
        SELECT tb_goods.id,tb_goods.name,tb_goods_image.url,tb_goods.min_price
        FROM tb_goods,tb_goods_image
    </sql>
    <sql id="goodsWhere">
        WHERE  tb_goods.visibility=0 AND  tb_goods_image.visibility=0
        AND  tb_goods.id=tb_goods_image.goods_id
        AND  tb_goods_image.`position`=1
        AND  tb_goods.is_putaway=0
    </sql>
    <sql id="goodsOrderBy">
        ORDER BY tb_goods.weight DESC ,tb_goods.sale_count DESC
    </sql>

    <!--查询所有商品-->
    <select id="queryAllGoods" resultMap="GoodsResult">
        <include refid="goodsSelect"/>
        <include refid="goodsWhere"/>
        <include refid="goodsOrderBy"/>
    </select>

    <!--根据搜索框进行查询-->
    <select id="queryBySearchGoods" parameterType="String" resultMap="GoodsResult">
        <include refid="goodsSelect"/>
        <include refid="goodsWhere"/>
        AND tb_goods.name LIKE CONCAT('%','${_parameter}','%' )
        <include refid="goodsOrderBy"/>
    </select>

    <!--根据筛选条件进行查询-->
    <select id="queryFilterGoods" parameterType="com.irelandlight.vo.FilterGoodsVO" resultMap="GoodsResult">
        <include refid="goodsSelect"/>
        <include refid="goodsWhere"/>
        <if test="use!=null">
            AND tb_goods.use = #{use}
        </if>
        <if test="taste!=null">
            AND tb_goods.taste=#{taste}
        </if>
        <if test="perference !=null">
            AND tb_goods.preference=#{perference}
        </if>
        <include refid="goodsOrderBy"/>
    </select>

</mapper>